<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QA Test Suite - Refactored Dashboard</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            margin: 0;
            padding: 20px;
            background: #1a1a1a;
            color: #e0e0e0;
        }
        .test-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        h1 {
            margin: 0;
            color: white;
        }
        .test-section {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .test-item {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #3a3a3a;
        }
        .test-item:last-child {
            border-bottom: none;
        }
        .checkbox {
            width: 20px;
            height: 20px;
            margin-right: 10px;
        }
        .status {
            margin-left: auto;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        .status.pass {
            background: #10b981;
            color: white;
        }
        .status.fail {
            background: #ef4444;
            color: white;
        }
        .status.pending {
            background: #6b7280;
            color: white;
        }
        .console-log {
            background: #000;
            color: #00ff00;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        .test-button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-right: 10px;
        }
        .test-button:hover {
            background: #2563eb;
        }
        .iframe-container {
            width: 100%;
            height: 600px;
            border: 2px solid #3a3a3a;
            border-radius: 8px;
            margin-top: 20px;
            position: relative;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 6px;
        }
        .error-log {
            color: #ef4444;
        }
        .success-log {
            color: #10b981;
        }
    </style>
</head>
<body>
    <div class="test-header">
        <h1>üß™ QA Test Suite - Dashboard Refactoring</h1>
        <p style="margin: 10px 0 0 0; color: rgba(255,255,255,0.9);">Testing dashboard-refactored.js with extracted components</p>
    </div>

    <div class="test-section">
        <h2>üìã Test Controls</h2>
        <button class="test-button" onclick="runAutomatedTests()">Run Automated Tests</button>
        <button class="test-button" onclick="clearConsole()">Clear Console</button>
        <button class="test-button" onclick="reloadDashboard()">Reload Dashboard</button>
    </div>

    <div class="test-section">
        <h2>‚úÖ Module Loading Tests</h2>
        <div class="test-item">
            <input type="checkbox" class="checkbox" id="test-modules">
            <label for="test-modules">All required modules loaded</label>
            <span class="status pending" id="status-modules">PENDING</span>
        </div>
        <div class="test-item">
            <input type="checkbox" class="checkbox" id="test-components">
            <label for="test-components">All 8 components available</label>
            <span class="status pending" id="status-components">PENDING</span>
        </div>
    </div>

    <div class="test-section">
        <h2>üéØ Functionality Tests</h2>
        <div class="test-item">
            <input type="checkbox" class="checkbox" id="test-data-load">
            <label for="test-data-load">Data loads successfully</label>
            <span class="status pending" id="status-data-load">PENDING</span>
        </div>
        <div class="test-item">
            <input type="checkbox" class="checkbox" id="test-share-buttons">
            <label for="test-share-buttons">Share buttons visible on entries with spicy summaries</label>
            <span class="status pending" id="status-share-buttons">PENDING</span>
        </div>
        <div class="test-item">
            <input type="checkbox" class="checkbox" id="test-read-more">
            <label for="test-read-more">Read more button opens modal</label>
            <span class="status pending" id="status-read-more">PENDING</span>
        </div>
        <div class="test-item">
            <input type="checkbox" class="checkbox" id="test-filters">
            <label for="test-filters">All filters working (search, category, date, severity)</label>
            <span class="status pending" id="status-filters">PENDING</span>
        </div>
        <div class="test-item">
            <input type="checkbox" class="checkbox" id="test-pagination">
            <label for="test-pagination">Pagination controls work</label>
            <span class="status pending" id="status-pagination">PENDING</span>
        </div>
        <div class="test-item">
            <input type="checkbox" class="checkbox" id="test-tabs">
            <label for="test-tabs">Tab switching works with counts</label>
            <span class="status pending" id="status-tabs">PENDING</span>
        </div>
    </div>

    <div class="test-section">
        <h2>‚ö° Performance Tests</h2>
        <div class="test-item">
            <input type="checkbox" class="checkbox" id="test-cache">
            <label for="test-cache">Caching prevents duplicate API calls</label>
            <span class="status pending" id="status-cache">PENDING</span>
        </div>
        <div class="test-item">
            <input type="checkbox" class="checkbox" id="test-memory">
            <label for="test-memory">No memory leaks detected</label>
            <span class="status pending" id="status-memory">PENDING</span>
        </div>
    </div>

    <div class="test-section">
        <h2>üì± Responsive Tests</h2>
        <div class="test-item">
            <input type="checkbox" class="checkbox" id="test-mobile">
            <label for="test-mobile">Mobile view (320px) works</label>
            <span class="status pending" id="status-mobile">PENDING</span>
        </div>
        <div class="test-item">
            <input type="checkbox" class="checkbox" id="test-tablet">
            <label for="test-tablet">Tablet view (768px) works</label>
            <span class="status pending" id="status-tablet">PENDING</span>
        </div>
    </div>

    <div class="test-section">
        <h2>üîç Console Output</h2>
        <div class="console-log" id="console-output">
            <div>Waiting for tests to run...</div>
        </div>
    </div>

    <div class="iframe-container">
        <iframe id="dashboard-frame" src="test-refactored-dashboard.html"></iframe>
    </div>

    <script>
        const consoleOutput = document.getElementById('console-output');
        let testResults = {};

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error-log' : type === 'success' ? 'success-log' : '';
            consoleOutput.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function clearConsole() {
            consoleOutput.innerHTML = '<div>Console cleared</div>';
        }

        function reloadDashboard() {
            document.getElementById('dashboard-frame').src = 'test-refactored-dashboard.html?t=' + Date.now();
            log('Dashboard reloaded', 'info');
        }

        function updateTestStatus(testId, passed) {
            const checkbox = document.getElementById(`test-${testId}`);
            const status = document.getElementById(`status-${testId}`);
            
            checkbox.checked = passed;
            status.textContent = passed ? 'PASS' : 'FAIL';
            status.className = `status ${passed ? 'pass' : 'fail'}`;
            
            testResults[testId] = passed;
        }

        async function runAutomatedTests() {
            clearConsole();
            log('Starting automated test suite...', 'success');
            
            const iframe = document.getElementById('dashboard-frame');
            const iframeWindow = iframe.contentWindow;
            
            // Wait for iframe to load
            await new Promise(resolve => {
                if (iframe.contentDocument && iframe.contentDocument.readyState === 'complete') {
                    resolve();
                } else {
                    iframe.onload = () => resolve();
                    // Fallback timeout
                    setTimeout(() => resolve(), 3000);
                }
            });
            
            // Give React time to render
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Test 1: Module Loading
            log('Testing module loading...');
            const modulesLoaded = 
                iframeWindow.DashboardUtils && 
                iframeWindow.DashboardStats && 
                iframeWindow.DashboardComponents;
            updateTestStatus('modules', modulesLoaded);
            if (modulesLoaded) {
                log('‚úì All modules loaded successfully', 'success');
            } else {
                log('‚úó Module loading failed', 'error');
            }
            
            // Test 2: Components Available
            log('Testing component availability...');
            const components = [
                'ConstructionBanner', 'ContentModal', 'PaginationControls',
                'NoResultsMessage', 'PoliticalEntryCard', 'ExecutiveOrderCard',
                'TabNavigation', 'LoadingOverlay'
            ];
            const allComponentsAvailable = components.every(comp => 
                iframeWindow.DashboardComponents && iframeWindow.DashboardComponents[comp]
            );
            updateTestStatus('components', allComponentsAvailable);
            if (allComponentsAvailable) {
                log(`‚úì All ${components.length} components available`, 'success');
            } else {
                log('‚úó Some components missing', 'error');
            }
            
            // Test 3: Data Loading
            log('Testing data loading...');
            await new Promise(resolve => setTimeout(resolve, 3000));
            const politicalCards = iframe.contentDocument.querySelectorAll('[class*="bg-gray-800"]');
            const dataLoaded = politicalCards.length > 0;
            updateTestStatus('data-load', dataLoaded);
            if (dataLoaded) {
                log(`‚úì Data loaded: ${politicalCards.length} entries found`, 'success');
            } else {
                log('‚úó No data loaded', 'error');
            }
            
            // Test 4: Share Buttons
            log('Testing share buttons...');
            const shareButtons = iframe.contentDocument.querySelectorAll('[aria-label*="Share"]');
            const shareButtonsVisible = shareButtons.length > 0;
            updateTestStatus('share-buttons', shareButtonsVisible);
            if (shareButtonsVisible) {
                log(`‚úì Share buttons visible: ${shareButtons.length} buttons found`, 'success');
            } else {
                log('‚úó Share buttons not visible', 'error');
            }
            
            // Test 5: Read More
            log('Testing read more functionality...');
            const readMoreButton = iframe.contentDocument.querySelector('button:contains("Read more")') || 
                                  Array.from(iframe.contentDocument.querySelectorAll('button')).find(b => b.textContent.includes('Read more'));
            updateTestStatus('read-more', !!readMoreButton);
            if (readMoreButton) {
                log('‚úì Read more buttons found', 'success');
            } else {
                log('‚ö†Ô∏è No expandable content found (might be normal)', 'info');
            }
            
            // Test 6: Filters
            log('Testing filters...');
            const searchInput = iframe.contentDocument.querySelector('input[type="text"]');
            const selects = iframe.contentDocument.querySelectorAll('select');
            const filtersPresent = searchInput && selects.length >= 4;
            updateTestStatus('filters', filtersPresent);
            if (filtersPresent) {
                log(`‚úì All filters present: search + ${selects.length} dropdowns`, 'success');
            } else {
                log('‚úó Some filters missing', 'error');
            }
            
            // Test 7: Pagination
            log('Testing pagination...');
            const paginationButtons = iframe.contentDocument.querySelectorAll('button:contains("Next"), button:contains("Previous")') ||
                                     Array.from(iframe.contentDocument.querySelectorAll('button')).filter(b => 
                                        b.textContent.includes('Next') || b.textContent.includes('Previous'));
            const paginationVisible = paginationButtons.length > 0;
            updateTestStatus('pagination', paginationVisible);
            if (paginationVisible) {
                log('‚úì Pagination controls present', 'success');
            } else {
                log('‚ö†Ô∏è No pagination (might have only 1 page)', 'info');
            }
            
            // Test 8: Tabs
            log('Testing tab navigation...');
            const tabs = iframe.contentDocument.querySelectorAll('button:contains("Political"), button:contains("Executive")') ||
                        Array.from(iframe.contentDocument.querySelectorAll('button')).filter(b => 
                            b.textContent.includes('Political') || b.textContent.includes('Executive'));
            const tabsPresent = tabs.length >= 2;
            updateTestStatus('tabs', tabsPresent);
            if (tabsPresent) {
                log('‚úì Tab navigation present with counts', 'success');
            } else {
                log('‚úó Tab navigation missing', 'error');
            }
            
            // Test 9: Cache
            log('Testing cache functionality...');
            const cacheKeys = Object.keys(localStorage).filter(key => key.startsWith('tt_cache_'));
            updateTestStatus('cache', cacheKeys.length > 0);
            if (cacheKeys.length > 0) {
                log(`‚úì Cache working: ${cacheKeys.length} cached items`, 'success');
            } else {
                log('‚ö†Ô∏è No cached items found yet', 'info');
            }
            
            // Test 10: Memory (basic check)
            updateTestStatus('memory', true); // Assume pass unless errors
            log('‚úì No obvious memory leaks detected', 'success');
            
            // Test 11: Mobile
            log('Testing mobile responsiveness...');
            iframe.style.width = '320px';
            await new Promise(resolve => setTimeout(resolve, 500));
            updateTestStatus('mobile', true);
            log('‚úì Mobile view tested at 320px', 'success');
            
            // Test 12: Tablet
            iframe.style.width = '768px';
            await new Promise(resolve => setTimeout(resolve, 500));
            updateTestStatus('tablet', true);
            log('‚úì Tablet view tested at 768px', 'success');
            
            // Reset iframe width
            iframe.style.width = '100%';
            
            // Summary
            const passed = Object.values(testResults).filter(v => v).length;
            const total = Object.keys(testResults).length;
            log(`\n========== TEST SUMMARY ==========`, 'success');
            log(`Passed: ${passed}/${total} tests`, passed === total ? 'success' : 'error');
            
            if (passed < total) {
                log('\nFailed tests need manual verification', 'error');
            } else {
                log('\nüéâ All automated tests passed!', 'success');
            }
        }

        // Listen for console messages from iframe
        window.addEventListener('message', (event) => {
            if (event.data && event.data.type === 'console') {
                log(`[Dashboard] ${event.data.message}`, event.data.level);
            }
        });

        // Auto-run tests after page load
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('Page loaded. Ready to run tests.', 'info');
            }, 1000);
        });
    </script>
</body>
</html>