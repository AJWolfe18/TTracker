<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Phase 4 QA Tests - TrumpyTracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-8">
    <div class="bg-yellow-600 text-black p-3 mb-6 font-bold text-center">
        ⚠️ TEST BRANCH ONLY - Automated QA Tests
    </div>
    
    <h1 class="text-2xl font-bold mb-6">Automated QA Test Results - Phase 4</h1>
    <div id="results" class="space-y-4"></div>

    <script>
        // Add error details
        window.addEventListener('error', (e) => {
            console.error('Error:', e);
        });
        
        // Load dashboard.js content for analysis
        fetch('dashboard.js')
            .then(res => {
                if (!res.ok) {
                    throw new Error(`HTTP ${res.status}: ${res.statusText}`);
                }
                return res.text();
            })
            .then(code => {
                console.log('Dashboard.js loaded, length:', code.length);
                const results = document.getElementById('results');
                let testsPassed = 0;
                let totalTests = 0;
                
                function addResult(category, test, passed, details) {
                    totalTests++;
                    if (passed) testsPassed++;
                    
                    const div = document.createElement('div');
                    div.className = 'bg-gray-800 p-4 rounded';
                    div.innerHTML = `
                        <h3 class="font-bold text-lg mb-2">${category}</h3>
                        <div class="flex items-center gap-2">
                            <span class="${passed ? 'text-green-400' : 'text-red-400'}">
                                ${passed ? '✅' : '❌'} ${test}
                            </span>
                        </div>
                        ${details ? `<p class="text-gray-400 text-sm mt-2">${details}</p>` : ''}
                    `;
                    results.appendChild(div);
                }
                
                // Test 1: XSS Vulnerabilities
                const xssPatterns = ['dangerouslySetInnerHTML', 'innerHTML', 'eval(', 'Function(', 'document.write'];
                let xssSafe = true;
                xssPatterns.forEach(pattern => {
                    if (code.includes(pattern)) {
                        xssSafe = false;
                        addResult('Security', `No ${pattern}`, false, `Found potential XSS vulnerability`);
                    }
                });
                if (xssSafe) {
                    addResult('Security', 'XSS Protection', true, 'No dangerous patterns found');
                }
                
                // Test 2: Memory Leaks
                const addListeners = (code.match(/addEventListener/g) || []).length;
                const removeListeners = (code.match(/removeEventListener/g) || []).length;
                addResult('Memory', 'Event Listener Cleanup', 
                    addListeners === removeListeners, 
                    `Added: ${addListeners}, Removed: ${removeListeners}`);
                
                // Test 3: Performance Optimizations
                const useMemoCount = (code.match(/useMemo/g) || []).length;
                const useCallbackCount = (code.match(/useCallback/g) || []).length;
                addResult('Performance', 'React Optimizations', 
                    useMemoCount >= 2 && useCallbackCount >= 5,
                    `useMemo: ${useMemoCount}, useCallback: ${useCallbackCount}`);
                
                // Test 4: Null Safety
                const optionalChaining = (code.match(/\?\./g) || []).length;
                addResult('Robustness', 'Null Safety', 
                    optionalChaining >= 20,
                    `Optional chaining uses: ${optionalChaining}`);
                
                // Test 5: Caching Implementation
                const cacheChecks = (code.match(/getCachedData/g) || []).length;
                addResult('Performance', 'Caching', 
                    cacheChecks >= 3,
                    `Cache checks: ${cacheChecks}`);
                
                // Test 6: Accessibility
                const ariaLabels = (code.match(/aria-label/g) || []).length;
                const ariaLive = (code.match(/aria-live/g) || []).length;
                addResult('Accessibility', 'ARIA Attributes', 
                    ariaLabels >= 2 && ariaLive >= 1,
                    `aria-label: ${ariaLabels}, aria-live: ${ariaLive}`);
                
                // Test 7: Error Handling
                const tryCatch = (code.match(/try\s*{/g) || []).length;
                const catchBlocks = (code.match(/catch\s*\(/g) || []).length;
                addResult('Error Handling', 'Try-Catch Blocks', 
                    tryCatch >= 5 && tryCatch === catchBlocks,
                    `Try blocks: ${tryCatch}, Catch blocks: ${catchBlocks}`);
                
                // Test 8: Debouncing
                const debounceRefs = (code.match(/searchDebounceRef/g) || []).length;
                addResult('Performance', 'Search Debouncing', 
                    debounceRefs >= 3,
                    `Debounce references: ${debounceRefs}`);
                
                // Test 9: Loading States
                const isFiltering = (code.match(/isFiltering/g) || []).length;
                addResult('UX', 'Loading States', 
                    isFiltering >= 4,
                    `Loading state uses: ${isFiltering}`);
                
                // Test 10: Animation Performance
                const animationLimit = code.includes('index < 10');
                addResult('Performance', 'Animation Limiting', 
                    animationLimit,
                    animationLimit ? 'Animations limited to first 10 items' : 'No animation limiting found');
                
                // Test 11: Style injection fix
                const styleIdCheck = code.includes("getElementById('tt-animations')");
                addResult('Memory', 'Style Injection Protection', 
                    styleIdCheck,
                    styleIdCheck ? 'Duplicate style prevention in place' : 'No style ID check found');
                
                // Summary
                setTimeout(() => {
                    const summary = document.createElement('div');
                    summary.className = 'bg-blue-900 p-6 rounded mt-8';
                    summary.innerHTML = `
                        <h2 class="text-xl font-bold mb-2">Test Summary</h2>
                        <p class="text-2xl ${testsPassed === totalTests ? 'text-green-400' : 'text-yellow-400'}">
                            ${testsPassed} / ${totalTests} Tests Passed
                        </p>
                        <p class="text-gray-300 mt-2">
                            ${testsPassed === totalTests ? '✅ All automated tests passed!' : '⚠️ Some tests need attention'}
                        </p>
                        <div class="mt-4 p-4 bg-gray-800 rounded">
                            <h3 class="font-bold mb-2">How to Test Phase 4 Features:</h3>
                            <ol class="list-decimal list-inside space-y-2 text-sm">
                                <li>Open <a href="phase4-test.html" class="text-blue-400 hover:underline">phase4-test.html</a> in another tab</li>
                                <li>Search for "asdfghjkl" to test No Results UI</li>
                                <li>Apply multiple filters quickly to see loading overlay</li>
                                <li>Check first 10 cards have fade-in animation</li>
                                <li>Test on mobile view (F12 → Toggle device toolbar)</li>
                            </ol>
                        </div>
                    `;
                    results.appendChild(summary);
                }, 100);
            })
            .catch(err => {
                results.innerHTML = `<div class="text-red-400">Error loading dashboard.js: ${err}</div>`;
            });
    </script>
</body>
</html>