# Handoff: ADO-337 Content History & Undo - Session 2

**Date:** 2026-02-05
**ADO:** #337 (Testing), #350 (tomorrow's card)
**Branch:** test
**Commits:** 62512a4, 900096d, 2a02b72, 08564ff

## Summary

Implemented full content history, undo support, and real-time re-enrichment. Code complete, needs testing and one setup step.

## What Was Built

| Component | Status |
|-----------|--------|
| Migrations 081-083 | ✅ Applied to TEST |
| admin-update-story edge function | ✅ Deployed (history logging + optimistic locking) |
| trigger-enrichment edge function | ✅ Deployed (triggers GitHub workflow) |
| UndoToast component | ✅ In admin.html |
| enrich-story.yml workflow | ✅ Committed |
| enrich-single-story.js | ✅ Committed |
| Expanded edit modal (800px, all fields) | ✅ Committed |

## Setup Required Before Testing

**GITHUB_PAT secret not yet configured.**

1. Create GitHub PAT: https://github.com/settings/tokens/new
   - Note: `TTracker Enrichment`
   - Scopes: `repo` (full), `workflow`

2. Add to Supabase:
   ```bash
   npx supabase secrets set GITHUB_PAT=ghp_xxxxx --project-ref wnrjrywpcadwutfykflu
   ```

## Test Checklist (ADO-350)

- [ ] Re-enrich button triggers workflow, completes in ~2 min
- [ ] Edit → Save → Undo toast appears (10 sec countdown)
- [ ] Click Undo → Field reverts
- [ ] `admin.content_history` table has logged changes
- [ ] Optimistic locking blocks concurrent edits
- [ ] All fields editable in larger modal

## After Testing Passes

1. Move ADO-337 to Ready for Prod
2. Deploy to PROD:
   ```bash
   npx supabase functions deploy admin-update-story --project-ref osjbulmltfpcoldydexg
   npx supabase functions deploy trigger-enrichment --project-ref osjbulmltfpcoldydexg
   ```
3. Apply migrations 081-083 to PROD
4. Add GITHUB_PAT to PROD Supabase secrets
5. Cherry-pick commits to main, create PR
